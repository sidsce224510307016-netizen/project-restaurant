<!DOCTYPE html>
<html>
<head>
    <title>Kitchen Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <h2>Kitchen Orders</h2>
        <div id="kitchen-list"></div>
    </div>

    <script>
       const supabaseUrl = 'YOUR_SUPABASE_URL';
const supabaseKey = 'YOUR_KEY';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

async function runAutoSeating() {
    // 1. Fetch all Pending orders (FIFO)
    const { data: orders, error: orderErr } = await supabase
        .from('orders')
        .select('*')
        .eq('status', 'Pending')
        .order('created_at', { ascending: true });

    // 2. Fetch available tables
    const { data: tables, error: tableErr } = await supabase
        .from('tables')
        .select('*')
        .eq('status', 'Available');

    if (orderErr || tableErr) return alert("Error fetching data");

    for (let order of orders) {
        // CASE A: Takeaway - No table needed, send straight to kitchen
        if (order.order_type === 'Takeaway') {
            await supabase.from('orders')
                .update({ status: 'Cooking', table_id: 0 }) // 0 or NULL signifies Takeaway
                .eq('id', order.id);
            continue; 
        }

        // CASE B: Dine In - Use Exact-Fit Priority Logic
        let match = tables.find(t => t.capacity === order.party_size);
        
        // Fallback: Smallest table that fits the group
        if (!match) {
            match = tables
                .filter(t => t.capacity >= order.party_size)
                .sort((a, b) => a.capacity - b.capacity)[0];
        }

        if (match) {
            // Assign the table and update status
            await supabase.from('orders')
                .update({ status: 'Cooking', table_id: match.id })
                .eq('id', order.id);

            await supabase.from('tables')
                .update({ status: 'Occupied' })
                .eq('id', match.id);

            // Remove table from local available list for this loop
            tables.splice(tables.indexOf(match), 1);
        }
    }
    alert("Queue processed! Refreshing dashboards...");
    location.reload();
}
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
<title>Manager</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="p-6">

<h1 class="page-title">Manager Dashboard</h1>

<div id="tables" class="grid"></div>
<h3>Waiting Queue</h3>
<div id="queue"></div>

<script>
const supabase = supabaseJs.createClient(
  "https://gvadtfpunbhbhuqeqsiq.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd2YWR0ZnB1bmJoYmh1cWVxc2lxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwMTU1NjYsImV4cCI6MjA4NDU5MTU2Nn0.4IWXlhGf5zS9P-8MJs4uT9XUkbr8CIdwLMNHLm6AQKc"
);

async function load() {
  const { data: tables } = await supabase.from("tables").select("*");
  const { data: queue } = await supabase.from("queue").select("*");

  document.getElementById("tables").innerHTML =
    tables.map(t => `
      <div class="card">
        Table ${t.number} (${t.capacity})
        ${t.occupied ? "Occupied" :
        `<button class="btn btn-success" onclick="assign(${t.number})">Assign</button>`}
      </div>`).join("");

  document.getElementById("queue").innerHTML =
    queue.map(q => `<div class="card">${q.name} (${q.people})</div>`).join("");
}

async function assign(table) {
  const { data: queue } = await supabase.from("queue").select("*");
  const match = queue.find(q => q.people <= 4);
  if (!match) return alert("No fit");

  await supabase.from("tables").update({ occupied: true }).eq("number", table);
  await supabase.from("orders").insert({
    name: match.name,
    items: match.items,
    people: match.people,
    table_number: table,
    status: "COOKING"
  });
  await supabase.from("queue").delete().eq("id", match.id);

  load();
}

load();
</script>
</body>
</html>

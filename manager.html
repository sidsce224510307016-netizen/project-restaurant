<!DOCTYPE html>
<html>
<head>
    <title>Manager Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <h2>Manager: Table Assignment</h2>
        <button class="btn-assign" onclick="runAutoSeating()">âš¡ Auto-Assign Tables</button>
        <hr>
        <div id="queue-list"> Loading Queue... </div>
    </div>

    <script>
        const supabase = supabase.createClient('YOUR_SUPABASE_URL', 'YOUR_KEY');

        async function runAutoSeating() {
            const { data: orders } = await supabase.from('orders').select('*').eq('status', 'Pending').order('created_at', {ascending: true});
            const { data: tables } = await supabase.from('tables').select('*').eq('status', 'Available');

            for (let order of orders) {
                // Logic: Exact fit first
                let match = tables.find(t => t.capacity === order.party_size);
                if(!match) match = tables.find(t => t.capacity > order.party_size);

                if(match) {
                    await supabase.from('orders').update({ status: 'Cooking', table_id: match.id }).eq('id', order.id);
                    await supabase.from('tables').update({ status: 'Occupied' }).eq('id', match.id);
                    alert(`Table ${match.id} assigned to ${order.customer_name}`);
                    location.reload();
                    break;
                }
            }
        }
    </script>
</body>
</html>